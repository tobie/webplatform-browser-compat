<!DOCTYPE html>
<html>
  <head>
    <title>Browser Compatibility Tables - Datamodel</title>
    <meta charset="utf-8" />
    <script src="http://www.w3.org/Tools/respec/respec-w3c-common" async="" class="remove"></script>
    <script class="remove">
      var respecConfig = {
          // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
          specStatus:           "unofficial"

          , shortName:            "compat tables"

          // editors, add as many as you like
          // only "name" is required
          , editors:  [
              {
                  name:       "Ronald Mansveld"
              ,   url:        "http://docs.webplatform.org/wiki/User:Ronaldmansveld"
              ,   mailto:     "ronald@ronaldmansveld.nl"
              ,   company:    "WebPlatform.org"
              ,   companyURL: "http://webplatform.org/"
              }
          ]
          , issueBase: "https://github.com/ronaldmansveld/webplatform-browser-compat/issues/"
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        WebPlatform.org expressed the wish to incorporate compatibility tables on the website, and provide the compatibility data through an easy to use API.
        The data for these tables will be collected from various websites. In order to streamline this process, a datamodel has to be drawn out to make the exchange of compatibility-data as easy as possible.
      </p>
    </section>
    
    <section id="sotd">
      <p>
        This document is first and foremost intended for internal use within the WebPlatform.org organization, and the websites that will share their compatibility-data with WebPlatform.org.
      </p>
    </section>
    
    <section class="introductory">
      <h2>Overview</h2>
      <p>
        In order to share data, it is important for the exchanging parties to agree on a datamodel to fit the data into. In order to create such a datamodel, several <a href="#datatypes"></a> will be introduced in this specification. The preferred format for the dataexchange, and thus the preferred format for the examples throughout this specification is [[JSON]]. However, propertynames for the Datatypes are chosen in such a way, that other formats like XML can be used as well.
      </p>
      <p class="issue" data-number="4">Statement about XML-compatible property names needs clarification. We should either reference format requirements or drop it altogether.</p>
    </section>

    <section id="conformance">
    </section>

    <section id="datatypes">
      <h2>Datatypes</h2>
      <p>All datatypes have a URI-field that points to a location on data.webplatform.org. If the URI is accessed through the HTTP-protocol, it will return a 301-status with a link to a webpage that contains more information, ie a spec of a feature. This way the URI's for the different models can stay the same, even though the URL's for specs etc. may change over time.</p>
      <p class="issue" data-number="5">Centralizing URIs on a single server has significant implementation costs. Who handles the server? Does the server have an API to automate the creation of URIs pairs? Who is going to implement this API and when will it be ready? What if the server goes down? Etc.</p>
      <section>
        <h2>UserAgent</h2>
        <p>
          The UserAgent Dictionary gives the details on a specific UserAgent such as version, vendor, name, and environment data like operating system and, in case of mobile devices, the data for the device. Please note that a UserAgent can not only be a browser on a computer or mobile device, but also software that displays webpages on game-consoles, refridgerators or watches.
        </p>
        <p class="issue" data-number="6">Use term User Agent instead of Browser for the related data type. Simplify wording accordingly.</p>
        
        <p>
          Even though one might be tempted to remove the UserAgent-dictionary completely, and just use the UA-string, this would impose problems for a number of useragents, especially mobile and embedded useragents, where different useragents use the same UA-string, or even one useragent uses multiple UA-strings.
        </p>
        <p class="issue" data-number="7">Is the statement that sometimes different browsers use an identical UA string correct? If so provide links/examples.</p>
        <p class="issue" data-number="27">If different browsers provenly use identical UA strings, how can we identify browsers remotely? This is a very common scenario when doing automated testing without direct access to the device.</p>
        <p class="issue" data-number="26">Why are we proposing to guard against multiple UA string for the same browser? This is easily reconciled by a by a UA parser.</p>
        <p class="issue" data-number="25">The specification needs to formally define names for operating systems, user agents and devices if it wants to avoid using UA strings as identifier.
          
          This list needs to be compatible with the output of an existing language-agnostic UA parser so that transforming UA strings into Browser datatypes can be automated. In the absence of such a list, each data set will end up using different names to identify the same browser (e.g. "IE", "MSIE", "Internet Explorer", etc.) which is generally painful to reconcile. I suggest agreeing on using the names output by a specific parser for this.</p>
        <dl title="dictionary UserAgent" class="idl">
          <dt>DOMString uri</dt>
          <dd>The uri where more information can be found</dd>
          <dt>DOMString uastring</dt>
          <dd>The UA-string for this user agent</dd>
          <dt>DOMString name</dt>
          <dd>The name for the user agent</dd>
          <dt>DOMString vendor</dt>
          <dd>The vendor of the user agent</dd>
          <dt>DOMString version</dt>
          <dd>The version of the user agent</dd>
          <dt>DOMString? os</dt>
          <dd>The OS the user agent runs on (if applicable)</dd>
          <dt>DOMString? osversion</dt>
          <dd>The version of the OS the user agent runs on (if applicable)</dd>
          <dt>DOMString? devicename</dt>
          <dd>The name of the device this user agent runs on (if applicable)</dd>
          <dt>DOMString? devicebrand</dt>
          <dd>The brand of the device this user agent runs on (if applicable)</dd>
          <dt>DOMString? devicemodel</dt>
          <dd>The model of the device this user agent runs on (if applicable)</dd>
        </dl>
        <p class="issue" data-number="24">The way to construct browser URIs needs to be precisely defined. What happens when some of the info is not available? E.g. a missing OS or browser versions? etc.</p>
        <p class="issue" data-number="23">The Browser data type is missing fields for device name, brand and model. These are critical on mobile where for example GPU integration is device specific.</p>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/useragent/internet_explorer/9.0/windows/7",
            "uastring":"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)",
            "name":"Internet Explorer",
            "vendor":"Microsoft",
            "version":"9.0",
            "os":"Windows",
            "osversion":"7"
          }
        </pre>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/useragent/google_chrome/30.0.1599.17/windows/8",
            "uastring":"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.17 Safari/537.36",
            "name":"Chrome",
            "vendor":"Google",
            "version":"30.0.1599.17",
            "os":"Windows",
            "osversion":"8"
          }
        </pre>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/useragent/android/2.3.3/htc/desire/gri40",
            "uastring":"Mozilla/5.0 (Linux; U; Android 2.3.3; de-de; HTC Desire Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
            "name":"Android",
            "vendor":"Google",
            "version":"2.3.3",
            "devicename":"Desire",
            "devicebrand":"HTC",
            "devicemodel":"GRI40"
          }
        </pre>
      </section>

      <section>
        <h2>FeatureCategory</h2>
        <p>
          In order to be able to display high-overview statistics, all features will be grouped in categories. By grouping features in categories, one can easily determine how much of a spec has been implemented in a specific useragent. For instance: HTML5 forms have several new input-types such as color, date, number, etc. By grouping these features in a HTML5-forms category, it is easily discernible if (and how much) of HTML5-forms is implemented.
        </p>
        <dl title="dictionary FeatureCategory" class="idl">
          <dt>DOMString uri</dt>
          <dd>The URI for this category</dd>
          <dt>DOMString name</dt>
          <dd>The name of this category</dd>
          <dt>DOMString? parent</dt>
          <dd>The parent-category of this category</dd>
        </dl>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/feature/css",
            "name":"CSS"
          }
        </pre>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/feature/api",
            "name":"API"
          }
        </pre>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/feature/css/flexbox",
            "parent":"data.webplatform.org/feature/css",
            "name":"Flexbox"
          }
        </pre>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/feature/api/battery",
            "parent":"data.webplatform.org/feature/api",
            "name":"Battery API"
          }
        </pre>
        <p class="issue" data-number="22">Avoid data.webplatform.org proxy for doc sections. I don't imagine webplatform.org doc sections will change without proper HTTP redirects. The extra-level of indirection here isn't useful.</p>
        <p class="issue" data-number="21">Clarify how specs fit in the hierarchy of categories and subcategories.</p>
        <p class="issue" data-number="20">Why distinguish between categories and subcategories? Instead, allow categories to be nested and subcategories just become categories with a parent.</p>
      </section>

      <section>
        <h2>Feature</h2>
        <p class="issue" data-number="19">How do feature match the organization of specs in sections and subsections? This is important because W3C tests map those.</p>
        <p>
          Features are the distinct capabalities of a user agent that will be tested. These can for instance be the different CSS2.1 selectors. Each feature can have multiple tests to check for conformance with the spec.
        </p>
        <dl title="dictionary Feature" class="idl">
          <dt>DOMString uri</dt>
          <dd>The URI for this feature</dd>
          <dt>DOMString name</dt>
          <dd>The name of this feature</dd>
          <dt>DOMString category</dt>
          <dd>The UID of the <a>FeatureCategory</a> this feature belongs to</dd>
          <dt>DOMString[] spec</dt>
          <dd>The URLs of the specifications of this feature</dd>
          <dt>DOMString othername</dt>
          <dd>Another name this feature might be known with</dd>
        </dl>
        <p class="issue" data-number="18">Estimating the importance of a feature is highly subjective. Importance of a feature is tied to the context. E.g. geo-location is critical for a maps application, not so much on a TV set. There's going to be ongoing disagreement about how this matters. I suggest dropping that property altogether. It is best implemented by third party building on the dataset for well scoped cases (e.g. mobile browser support for building 2D games).</p>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/feature/api/battery/navigator.battery",
            "name":"NavigatorBattery",
            "category":"data.webplatform.org/feature/api/battery",
            "spec":"http://www.w3.org/TR/battery-status/",
            "othername":""
          }
        </pre>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/feature/api/battery/batterystatus",
            "name":"BatteryManager",
            "category":"data.webplatform.org/feature/api/battery",
            "spec":"http://www.w3.org/TR/battery-status/",
            "othername":"Batterystatus"
          }
        </pre>
      </section>

      <section>
        <h2>Testsource</h2>
        <p>
          The testsource is the entity that performed the test, and published the results. These can be sites such as html5test.com, caniuse.com or quirksmode.org. The URL-field is used in the same way URI-fields are used with other Dictionaries.
        </p>
        <dl title="dictionary Testsource" class="idl">
          <dt>DOMString name</dt>
          <dd>The name of the testsource</dd>
          <dt>DOMString url</dt>
          <dd>URL for this testsource</dd>
        </dl>
        <p class="issue" data-number="17">URI for test resources is redundant given TestResource URLs are unique. Also, the distinction between URIs and URLs is tenuous and will confuse many.</p>
        <pre class="example highlight">
          {
            "name":"html5test",
            "url":"http://www.html5test.com"
          }
        </pre>
        <pre class="example highlight">
          {
            "name":"w3c",
            "url":"http://www.w3.org/Style/CSS/Test/Overview.en.html"
          }
        </pre>
      </section>

      <section>
        <h2>Test</h2>
        <p>
          A test is a distinct testcase (not a test-file), testing (part of) a feature. In case of multiple test-cases in one testfile, the URL SHOULD contain an anchor which points to the testcase.
        </p>
        <dl title="dictionary Test" class="idl">
          <dt>DOMString uri</dt>
          <dd>The URI for this test</dd>
          <dt>DOMString testsource</dt>
          <dd>The URL for the <a>Testsource</a> of this test</dd>
          <dt>DOMString name</dt>
          <dd>The name of this test</dd>
          <dt>DOMString feature</dt>
          <dd>The URI for the <a>Feature</a> that is tested by this test</dd>
          <dt>DOMString url</dt>
          <dd>The URL where more information/documentation of this test can be found</dd>
        </dl>
        <p class="issue" data-number="16">Clarify whether the Test data type refers to test cases or test files. Generally, script-based W3C tests have multiple tests per files. There are specific issues in either case. If we consider that a Test data-type is a test file, we're going to have to deal with the wide variety of breadth of a given test file which sometimes include thousands of tests. If on the other hand we consider each test separately, we'll have URI and linking challenges.</p>
        <p class="issue" data-number="15">The Test object doesn't account for the fact that some tests sometimes test multiple features. The feature property probably needs to be an array.</p>
        <p class="issue" data-number="14">We need to address the relationship between features and spec sections. W3C tests link to specs sections. If we separate the notiosn of spec sections and features, how are we planning to convert links to spec sections into feature URIs?</p>
        <p class="issue" data-number="13">Relative test importance is too subjective a criteria and should be discarded. At the very least this needs to be optional, as no W3C test has those this property nor is there a plan to add it in the future. There are probably unwanted side-effects of adding such a criteria. I recommend strongly against it.</p>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/test/w3c/counters-001",
            "testsource":"http://www.w3.org/Style/CSS/Test/Overview.en.html",
            "name":"counters-001",
            "feature":"data.webplatform.org/feature/css/css21/counter",
            "url":"http://test.csswg.org/suites/css2.1/20110323/html4/chapter-4.html"
          }
        </pre>
        <pre class="example highlight">
          {
            "uri":"http://data.webplatform.org/test/w3c/counters-002",
            "testsource":"http://www.w3.org/Style/CSS/Test/Overview.en.html",
            "name":"counters-002",
            "feature":"data.webplatform.org/feature/css/css21/counter",
            "url":"http://test.csswg.org/suites/css2.1/20110323/html4/chapter-4.html"
          }
        </pre>
      </section>

      <section>
        <h2>Result</h2>
        <p class="issue" data-number="12">Distinction between the Result and TestResult type is confusing. I suggest adding a status field to TestResult instead which accepts the following values: "success", "failure", "not run", "timeout" (and "partial" if you insist, but there's lot of issues with this).</p>
        
        <p>
          In order to correctly identify the outcome of a test, it is necessary to normalize the testresults. Note that while testsources are free to maintain their own set of results, those results MUST be translated to one of these results.
        </p>
        <p>
          The definition of a <a>TestResult</a> shows that an array of results is allowed. This is done so testsources can; besides a passed, partial or failed result; also designate whether the feature can only be used prefixed, and whether a polyfill is available.
        </p>
        <dl title="enum Result" class="idl">
          <dt>passed</dt>
          <dd>Signifies that the test was passed</dd>
          <dt>partial</dt>
          <dd>Signifies that the test only passed partial. Note that in case of partial passed tests, it is RECOMMENDED that the test is split up in different tests, so that each test will have a result that is either passed or fail. Also, with partial passed tests, the <a>Testsource</a> SHOULD include a note with the <a>TestResult</a> with further information.</dd>
          <dt>failed</dt>
          <dd>Signifies that the test has failed</dd>
          <dt>not tested</dt>
          <dd>Signifies that the feature was not tested. It is RECOMMENDED that the <a>Testsource</a> includes a note with the <a>TestResult</a> on why the test hasn't run.</dd>
          <dt>polyfill</dt>
          <dd>A polyfill is available to make this feature work in this user agent. It is RECOMMENDED that the <a>Testsource</a> includes a note with the <a>TestResult</a> that links to the available polyfill(s)</dd>
        </dl>
        <p class="issue" data-number="11">Existence of a polyfill shouldn't be tied to a test result but to a feature.</p>
      </section>

      <section>
        <h2>TestResult</h2>
        <p>
          TestResults are the most important part of the datamodel, since these connect a user agent, a feature and a test together, and shows what the result of the test is.
        </p>
        <p>
          While one would expect a test to have just a single <a>Result</a>, this definition allowes an array of results. This is done so testsources can also designate whether the feature can only be used prefixed, and whether a polyfill is available. However, the array of results MUST only contain exactly 1 (one) of 'passed', 'partial' or 'failed'. Both 'prefixed' and 'polyfill' are optional, and MAY be combined.
        </p>
        <p>
          Notes are a free textfield where results can be clarified, or specific behaviour can be explained.
        </p>
        <dl title="dictionary TestResult" class="idl">
          <dt>DOMString useragent</dt>
          <dd>The URI for the <a>UserAgent</a> this <a>Test</a> was run on</dd>
          <dt>DOMString test</dt>
          <dd>The <a>Test</a> that was run</dd>
          <dt>Result[] result</dt>
          <dd>The Results of this test</dd>
          <dt>DOMString notes</dt>
          <dd>Notes considering the testresults</dd>
          <dt>DOMString? prefix</dt>
          <dd>The prefix used to run this test</dd>
        </dl>
        <pre class="example highlight">
          {
            "useragent":"data.webplatform.org/useragent/internet_explorer/9.0/windows/7",
            "test":"data.webplatform.org/test/w3c/counter-001",
            "result":["passed"],
            "notes":""
          }
        </pre>
        <pre class="example highlight">
          {
            "useragent":"data.webplatform.org/useragent/opera/12.10/windows/8",
            "test":"data.webplatform.org/test/html5test/scoped-style",
            "result":["partial"],
            "notes":"Implemented as readonly instead of full access.",
            "prefix":"o"
          }
        </pre>
      </section>

      <section>
        <h2>CompatibilityTable</h2>
        <p>
          The CompatibilityTable combines all the different testresults, and also contains all data referenced in the other types. When creating a compatibilitytable, the <a>Testsource</a>, in order to easy lookups throughout the table, SHOULD use the UUID of the respective element as the key in the array, if possible in the underlying format. In case of JSON this would mean that, instead of JSON-arrays, JSON-objects should be used.
        </p>
        <p class="issue" data-number="10">Using identifiers as object keys implies that you risk having a discrepancy between the key of the object and the object's uid field. How to handle this discrepancy needs to be specified (or this proposal dropped in favor of using arrays).</p>
        <p class="issue" data-number="9">The RFC 2119 SHOULD in CompatibilityTable section must be a MUST. Change the sentence: "the Testsource, in order to easy lookups throughout the table, SHOULD use the UUID of the respective element as the key in the array, if possible in the underlying format" to "the Testsource, in order to easy lookups throughout the table, MUST use the UUID of the respective element as the key in the array".</p>
        <p class="issue" data-number="8">What is the use case for the CompatibilityTable data format? It seems this is an implementation detail of webplatform.org compat tables and doesn't need to be provided by Test resources not exposed as such by the API.</p>
        <dl title="dictionary CompatibilityTable" class="idl">
          <dt>UserAgent[] useragents</dt>
          <dd>The user agents that are present in this table</dd>
          <dt>FeatureCategory[] featurecategories</dt>
          <dd>The categories the features present in this table belong to</dd>
          <dt>Feature[] features</dt>
          <dd>The features that are present in this table</dd>
          <dt>Testsource[] sources</dt>
          <dd>The sources that created these results</dd>
          <dt>Test[] tests</dt>
          <dd>The tests that have been performed to create this table</dd>
          <dt>TestResult[] results</dt>
          <dd>The results of the performed tests</dd>
        </dl>
        <pre class="example highlight">
          {
            "useragents":{
              "data.webplatform.org/useragent/internet_explorer/9.0/windows/7":{
                "uri":"http://data.webplatform.org/useragent/internet_explorer/9.0/windows/7",
                "name":"Internet Explorer",
                "vendor":"Microsoft",
                "version":"9.0",
                "os":"windows",
                "osversion":"7"
              },
              "data.webplatform.org/useragent/opera/12.10/windows/8":{
                "uri":"http://data.webplatform.org/useragent/opera/12.10/windows/8",
                "name":"Opera"
                "vendor":"Opera",
                "version":"12.10",
                "os":"windows",
                "os-version":"8"
              }
            },
            "featurecategories":{
              "data.webplatform.org/feature/css":{
                "uri":"http://data.webplatform.org/feature/css",
                "name":"CSS"
              },
              "data.webplatform.org/feature/api":{
                "uri":"http://data.webplatform.org/feature/api",
                "name":"API"
              }
              "data.webplatform.org/feature/css/flexbox":{
                "uri":"http://data.webplatform.org/feature/css/flexbox",
                "category":"data.webplatform.org/feature/css",
                "name":"Flexbox"
              },
              "data.webplatform.org/feature/api/battery":{
                "uri":"http://data.webplatform.org/feature/api/battery",
                "category":"data.webplatform.org/feature/api",
                "name":"Battery API"
              }
            },
            "features":{
              "data.webplatform.org/feature/api/battery/navigator.battery":{
                "uri":"http://data.webplatform.org/feature/api/battery/navigator.battery",
                "name":"NavigatorBattery",
                "category":"data.webplatform.org/feature/api/battery",
                "spec":"http://www.w3.org/TR/battery-status/",
                "othername":""
              },
              "data.webplatform.org/feature/api/battery/batterystatus":{
                "uri":"http://data.webplatform.org/feature/api/battery/batterystatus",
                "name":"BatteryManager",
                "category":"data.webplatform.org/feature/api/battery",
                "spec":"http://www.w3.org/TR/battery-status/",
                "othername":"Batterystatus"
              }
            },
            "sources":{
              "http://www.w3.org/Style/CSS/Test/Overview.en.html":{
                "name":"w3c",
                "url":"http://www.w3.org/Style/CSS/Test/Overview.en.html"
              }
            },
            "tests":{
              "data.webplatform.org/test/w3c/navigator.battery":{
                "uri":"http://data.webplatform.org/test/w3c/navigator.battery",
                "testsource":"http://www.w3.org/Style/CSS/Test/Overview.en.html",
                "name":"navigator.battery",
                "feature":"data.webplatform.org/feature/api/battery/navigator.battery",
                "url":"http://test.csswg.org/suites/css2.1/20110323/html4/chapter-4.html"
              },
              "data.webplatform.org/test/w3c/batterymanager":{
                "uri":"http://data.webplatform.org/test/w3c/batterymanager",
                "testsource":"http://www.w3.org/Style/CSS/Test/Overview.en.html",
                "name":"batterymanager",
                "feature":"data.webplatform.org/feature/api/battery/batterymanager",
                "url":"http://test.csswg.org/suites/css2.1/20110323/html4/chapter-4.html"
              }
            },
            "results":[
              {
                "useragent":"data.webplatform.org/useragent/internet_explorer/9.0/windows/7",
                "test":"data.webplatform.org/test/w3c/navigator.battery",
                "result":["passed"],
                "notes":""
              },
              {
                "useragent":"data.webplatform.org/useragent/opera/12.10/windows/8",
                "test":"data.webplatform.org/test/w3c/batterymanager",
                "result":["partial"],
                "notes":"Implemented as readonly instead of full access.",
                "prefix":"o"
              }
            ]
          }
        </pre>
      </section>
    </section>
    
  </body>
</html>


